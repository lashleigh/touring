/*
 * g.Raphael 0.4.2 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.linechart=function(a,b,c,d,e,f,g){function h(a,b){var c=a.length/b,d=0,e=c,f=0,g=[];while(d<a.length)e--,e<0?(f+=a[d]*(1+e),g.push(f/c),f=a[d++]*-e,e+=c):f+=a[d++];return g}function i(a,b,c,d,e,f){var g=(c-a)/2,h=(e-c)/2,i=Math.atan((c-a)/Math.abs(d-b)),j=Math.atan((e-c)/Math.abs(d-f));i=b<d?Math.PI-i:i,j=f<d?Math.PI-j:j;var k=Math.PI/2-(i+j)%(Math.PI*2)/2,l=g*Math.sin(k+i),m=g*Math.cos(k+i),n=h*Math.sin(k+j),o=h*Math.cos(k+j);return{x1:c-l,y1:d+m,x2:c+n,y2:d+o}}function V(g){var h=[];for(var i=0,k=e.length;i<k;i++)h=h.concat(e[i]);h.sort();var l=[],m=[];for(i=0,k=h.length;i<k;i++)h[i]!=h[i-1]&&l.push(h[i])&&m.push(a+j+(h[i]-y)*D);h=l,k=h.length;var p=g||n.set();for(i=0;i<k;i++){var r=m[i]-(m[i]-(m[i-1]||a))/2,s=((m[i+1]||a+c)-m[i])/2+(m[i]-(m[i-1]||a))/2,t;g?t={}:p.push(t=n.rect(r-1,b,Math.max(s+1,1),d).attr({stroke:"none",fill:"#000",opacity:0})),t.values=[],t.symbols=n.set(),t.y=[],t.x=m[i],t.axis=h[i];for(var u=0,v=f.length;u<v;u++){l=e[u]||e[0];for(var w=0,x=l.length;w<x;w++)l[w]==h[i]&&(t.values.push(f[u][w]),t.y.push(b+d-j-(f[u][w]-B)*E),t.symbols.push(q.symbols[u][w]))}g&&g.call(t)}!g&&(o=p)}function W(c){var g=c||n.set(),h;for(var i=0,k=f.length;i<k;i++)for(var l=0,m=f[i].length;l<m;l++){var o=a+j+((e[i]||e[0])[l]-y)*D,r=a+j+((e[i]||e[0])[l?l-1:1]-y)*D,s=b+d-j-(f[i][l]-B)*E;c?h={}:g.push(h=n.circle(o,s,Math.abs(r-o)/2).attr({stroke:"none",fill:"#000",opacity:0})),h.x=o,h.y=s,h.value=f[i][l],h.line=q.lines[i],h.shade=q.shades[i],h.symbol=q.symbols[i][l],h.symbols=q.symbols[i],h.axis=(e[i]||e[0])[l],c&&c.call(h)}!c&&(p=g)}g=g||{},this.raphael.is(e[0],"array")||(e=[e]),this.raphael.is(f[0],"array")||(f=[f]);var j=g.gutter||10,k=Math.max(e[0].length,f[0].length),l=g.symbol||"",m=g.colors||Raphael.fn.g.colors,n=this,o=null,p=null,q=this.set(),r=[];for(var s=0,t=f.length;s<t;s++)k=Math.max(k,f[s].length);var u=this.set();for(s=0,t=f.length;s<t;s++)g.shade&&u.push(this.path().attr({stroke:"none",fill:m[s],opacity:g.nostroke?1:.3})),f[s].length>c-2*j&&(f[s]=h(f[s],c-2*j),k=c-2*j),e[s]&&e[s].length>c-2*j&&(e[s]=h(e[s],c-2*j));var v=Array.prototype.concat.apply([],e),w=Array.prototype.concat.apply([],f),x=this.g.snapEnds(Math.min.apply(Math,v),Math.max.apply(Math,v),e[0].length-1),y=x.from,z=x.to,A=this.g.snapEnds(Math.min.apply(Math,w),Math.max.apply(Math,w),f[0].length-1),B=A.from,C=A.to,D=(c-j*2)/(z-y||1),E=(d-j*2)/(C-B||1),F=this.set();if(g.axis){var G=(g.axis+"").split(/[,\s]+/);+G[0]&&F.push(this.g.axis(a+j,b+j,c-2*j,y,z,g.axisxstep||Math.floor((c-2*j)/20),2)),+G[1]&&F.push(this.g.axis(a+c-j,b+d-j,d-2*j,B,C,g.axisystep||Math.floor((d-2*j)/20),3)),+G[2]&&F.push(this.g.axis(a+j,b+d-j,c-2*j,y,z,g.axisxstep||Math.floor((c-2*j)/20),0)),+G[3]&&F.push(this.g.axis(a+j,b+d-j,d-2*j,B,C,g.axisystep||Math.floor((d-2*j)/20),1))}var H=this.set(),I=this.set(),J;for(s=0,t=f.length;s<t;s++){g.nostroke||H.push(J=this.path().attr({stroke:m[s],"stroke-width":g.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":g.dash||""}));var K=this.raphael.is(l,"array")?l[s]:l,L=this.set();r=[];for(var M=0,N=f[s].length;M<N;M++){var O=a+j+((e[s]||e[0])[M]-y)*D,P=b+d-j-(f[s][M]-B)*E;(Raphael.is(K,"array")?K[M]:K)&&L.push(this.g[Raphael.fn.g.markers[this.raphael.is(K,"array")?K[M]:K]](O,P,(g.width||2)*3).attr({fill:m[s],stroke:"none"}));if(g.smooth){if(M&&M!=N-1){var Q=a+j+((e[s]||e[0])[M-1]-y)*D,R=b+d-j-(f[s][M-1]-B)*E,S=a+j+((e[s]||e[0])[M+1]-y)*D,T=b+d-j-(f[s][M+1]-B)*E,U=i(Q,R,O,P,S,T);r=r.concat([U.x1,U.y1,O,P,U.x2,U.y2])}M||(r=["M",O,P,"C",O,P])}else r=r.concat([M?"L":"M",O,P])}g.smooth&&(r=r.concat([O,P,O,P])),I.push(L),g.shade&&u[s].attr({path:r.concat(["L",O,b+d-j,"L",a+j+((e[s]||e[0])[0]-y)*D,b+d-j,"z"]).join(",")}),!g.nostroke&&J.attr({path:r.join(",")})}return q.push(H,u,I,F,o,p),q.lines=H,q.shades=u,q.symbols=I,q.axis=F,q.hoverColumn=function(a,b){return!o&&V(),o.mouseover(a).mouseout(b),this},q.clickColumn=function(a){return!o&&V(),o.click(a),this},q.hrefColumn=function(a){var b=n.raphael.is(arguments[0],"array")?arguments[0]:arguments;if(!(arguments.length-1)&&typeof a=="object")for(var c in a)for(var d=0,e=o.length;d<e;d++)o[d].axis==c&&o[d].attr("href",a[c]);!o&&V();for(d=0,e=b.length;d<e;d++)o[d]&&o[d].attr("href",b[d]);return this},q.hover=function(a,b){return!p&&W(),p.mouseover(a).mouseout(b),this},q.click=function(a){return!p&&W(),p.click(a),this},q.each=function(a){return W(a),this},q.eachColumn=function(a){return V(a),this},q}